(()=>{var w="color: #E67E22;";function t(e){console.log(`%c[lgse] ${e}`,w)}function p(e,d){t(`Finding cache: ${e}`);let i=new Date,l=new Date().getTime();i.setTime(parseInt(GM_getValue(`cache/time_${e}`,"0"),10));let s={};l-i>864e5?(t("Cache miss"),GM_xmlhttpRequest({method:"GET",url:e,onload(o){t(`Request success: HTTP ${o.status}, Content: ${o.responseText}`),s={error:!1,status:o.status,content:o.responseText},o.status===200&&(GM_setValue(`cache/content_${e}`,JSON.stringify(s)),GM_setValue(`cache/time_${e}`,new Date().getTime().toString())),d(s)},onerror(o){t(`Request failed: HTTP ${o.status}`),s={error:!0,status:o.status},d(s)}})):(t("Cache hit"),s=JSON.parse(GM_getValue(`cache/content_${e}`)),d(s))}var c="2.1.3",f=[/\/discuss\/[0-9]+/,/\/user\/[0-9]+/,/\/chat.*/];function q(){if(document.location.pathname==="/")return!0;for(let e=0;e<f.length;e++)if(f[e].test(document.location.pathname))return!0;return!1}var r=["aini","aiq","am","azgc","baiy","bangbangt","banzz","baojin","bb","bkx","bl","bp","bq","bs","bt","bu","bz","cd","cg","ch","cha","chi","cj","cp","cs","cy","dan","dao","dax","db","dg","dk","dl","doge","dx","dy","dz","ee","emm","fad","fan","fd","fendou","fj","fn","fw","gg","gy","gz","hanx","haob","hb","hc","hd","hec","hhd","hn","hp","hq","hsh","ht","huaix","hx","jd","jh","jiaybb","jiaybs","jie","jk","jw","jx","jy","ka","kb","kel","kf","kg","kk","kl","kt","kuk","kun","kzht","lb","lengh","lh","ll","lm","lq","lw","lyj","mdfq","mg","mm","ng","nkt","oh","oy","pch","pj","pp","px","pz","qd","qiang","qiao","qidao","qq","qt","ruo","sa","se","sh","shd","shl","shq","shuai","shui","shxi","sr","tiao","tl","tnl","tp","ts","tsh","tt","tuu","tx","ty","wbk","whl","wl","wn","wosl","wq","ws","wul","wx","wzm","xhx","xia","xig","xin","xjj","xk","xs","xu","xw","xy","xyx","yao","yb","yhh","yiw","yl","youl","youtj","yt","yun","yx","zhd","zhem","zhh","zhm","zhq","zj","zk","zq","zt","zuotj","zyj"],z="(>[^<]*?)(/%EMOJI%)([^<A-Za-z])",g='$1<span style="color: #c8c8c8; font-size: 0.3em;">$2</span><img src="%SOURCE%" alt="/%EMOJI%" width="28px" height="28px">$3';function _(){let e=[document.querySelectorAll(".am-comment-bd"),document.querySelectorAll(".content"),document.querySelectorAll(".message-block")],d=!1;for(let i=0;i<e.length;i++)for(let l=0;l<e[i].length;l++)if(e[i][l].innerHTML.indexOf("<!--LGSE Replaced-->")===-1){let s=e[i][l].innerHTML;for(let o=r.length-1;o>=0;o--){s=s.replace(new RegExp(`(/${r[o]})(<span)`,"g"),"$1 $2"),s=s.replace(new RegExp(`(/${r[o]})(</{0,1}[^s/])`,"g"),"$1 $2");let y=new RegExp(z.replace(/%EMOJI%/g,r[o]),"g");for(;y.test(s);)s=s.replace(y,g.replace(/%EMOJI%/g,r[o])),d=!0}s+="<!--LGSE Replaced-->",e[i][l].innerHTML=s}d&&t("Replaced")}function b(){_(),setTimeout(b,1e3)}var a=`<style>
.se-ent {
    z-index: 100;
    position: fixed;
    left: 30px;
    bottom: 30px;
    border-radius: 5px;
    background-color: #fff;
    padding: 11px;
    width: auto;
    height: auto;
    cursor: pointer;
}
.se-ent:hover {
    background-color: #ccc;
}
.se-mnu {
    z-index: 100;
    position: fixed;
    top: 30px;
    left: 30px;
    border-radius: 5px;
    background-color: #fff;
    padding: 5px;
    display: none;
    width: max(35%, 300px);
    height: calc(100% - 130px);
    border: 1px solid #0e90d2;
}
.se-emj {
    float: left;
    background-color: #eee;
    width: calc(28px + 7em);
    height: auto;
    border-radius: 2px;
    margin: 5px;
}
.se-emj:hover {
    background-color: #ccc;
}
.se-ipt {
    width: calc(100% - 10px);
    height: 1.5em;
    margin-top: 0.25em;
    margin-bottom: 0.25em;
}
.se-dsp {
    width: auto;
    height: auto;
    overflow: auto;
}
</style>
<script>
var st_mnu = 0, st_cgl = 0;
var emoji=["aini","aiq","am","azgc","baiy","bangbangt","banzz","baojin","bb","bkx","bl","bp","bq","bs","bt","bu","bz","cd","cg","ch","cha","chi","cj","cp","cs","cy","dan","dao","dax","db","dg","dk","dl","doge","dx","dy","dz","ee","emm","fad","fan","fd","fendou","fj","fn","fw","gg","gy","gz","hanx","haob","hb","hc","hd","hec","hhd","hn","hp","hq","hsh","ht","huaix","hx","jd","jh","jiaybb","jiaybs","jie","jk","jw","jx","jy","ka","kb","kel","kf","kg","kk","kl","kt","kuk","kun","kzht","lb","lengh","lh","ll","lm","lq","lw","lyj","mdfq","mg","mm","ng","nkt","oh","oy","pch","pj","pp","px","pz","qd","qiang","qiao","qidao","qq","qt","ruo","sa","se","sh","shd","shl","shq","shuai","shui","shxi","sr","tiao","tl","tnl","tp","ts","tsh","tt","tuu","tx","ty","wbk","whl","wl","wn","wosl","wq","ws","wul","wx","wzm","xhx","xia","xig","xin","xjj","xk","xs","xu","xw","xy","xyx","yao","yb","yhh","yiw","yl","youl","youtj","yt","yun","yx","zhd","zhem","zhh","zhm","zhq","zj","zk","zq","zt","zuotj","zyj"];
var emjhtml = '<div class="se-emj"><img src="%SOURCE%" alt="/%EMOJI%" width="28px" height="28px"> | %EMOJI%</div>';
var srh = %SRH%;
if (!srh)
{
    document.getElementById("se-srh").style.display = "none";
}
function se_mnu()
{
    if (srh || document.getElementById("se-upd").innerText != "")
    {
        st_mnu = 1 - st_mnu;
        document.getElementById("se-mnu").style.display = (st_mnu == 0 ? "none" : "grid");
    }
    if (srh && st_mnu == 1)
    {
        se_srh();
    }
}
function se_srh()
{
    let wd = document.getElementById("se-ipt").value;
    let ih = "";
    for (let i = 0; i < emoji.length; i++)
    {
        if (wd == "" || emoji[i].replace(wd, "") != emoji[i])
        {
            ih += emjhtml.replace(/%EMOJI%/g, emoji[i]);
        }
    }
    document.getElementById("se-dsp").innerHTML = ih;
}
function se_cgl()
{
    st_cgl = 1 - st_cgl;
    document.getElementById("se-cgl").style.display = (st_cgl == 0 ? "none" : "block");
}
<\/script>
<div class="se-ent" id="se-ent" onclick="se_mnu()" oncontextmenu="window.open('https://lgse.netlify.app/lgse-settings-${c}.html')" title="\u53F3\u952E\u6253\u5F00\u8BBE\u7F6E" status="ordinary">
    <img src="%SOURCE_CY%" width="28px" height="28px">
</div>
<div class="se-mnu" id="se-mnu">
    <div class="se-dsp" id="se-srh">
        <input type="text" class="se-ipt" id="se-ipt" placeholder="\u641C\u7D22\u8868\u60C5..." oninput="se_srh()">
        <div class="se-dsp" id="se-dsp"></div>
    </div>
    <div class="se-dsp" id="se-upd" style="display: none;">
        <center id="se-upm"><b>LGSE \u66F4\u65B0</b><br></center>
        <div class="se-dsp" id="se-cgl" style="display: none;"><center><b>\u66F4\u65B0\u65E5\u5FD7</b><br></center></div>
    </div>
</div>`;function I(){$("body").append(a)}var v=/[0-9]+\.[0-9]+\.[0-9]+/g,S="https://lgse-source.netlify.app/version",O="https://lgse-source.netlify.app/changelog.txt",M=`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="28px" width="28px">
    <circle cx="14" cy="14" r="14" stroke-width="0" fill="#fe4c61" />
    <line x1="14" y1="5" x2="5" y2="14" stroke="#fff" stroke-width="3" stroke-linecap="round" />
    <line x1="14" y1="5" x2="23" y2="14" stroke="#fff" stroke-width="3" stroke-linecap="round" />
    <line x1="14" y1="5" x2="14" y2="23" stroke="#fff" stroke-width="3" stroke-linecap="round" />
</svg>`,m='<img src="%SOURCE_CY%" width="28px" height="28px">';function R(e){$("#se-upm").append(`\u5F53\u524D <b><span style="color: #e67e22;">${c}</span></b> --&gt; \u6700\u65B0 <b><span style="color: #52c41a;">${e}</span></b><br><a href="https://lgse-source.netlify.app/LuoguShowEmoji.min.user.js" style="font-size: 0.7em">\u70B9\u51FB\u5347\u7EA7</a> <a onclick="se_cgl()" style="font-size: 0.7em">\u663E\u793A/\u9690\u85CF\u66F4\u65B0\u65E5\u5FD7</a>`),t("Popped upgrade content")}function B(e){$("#se-upm").append(`\u5F53\u524D <b><span style="color: #52c41a;">${c}</span></b> &lt;-- \u6700\u65B0 <b><span style="color: #e67e22;">${e}</span></b><br><a href="https://lgse-source.netlify.app/LuoguShowEmoji.min.user.js" style="font-size: 0.7em">\u70B9\u51FB\u964D\u7EA7</a> <a onclick="se_cgl()" style="font-size: 0.7em">\u663E\u793A/\u9690\u85CF\u66F4\u65B0\u65E5\u5FD7</a>`),t("Popped downgrade content")}function T(){$("#se-upm").append(`\u5F53\u524D <b><span style="color: #52c41a;">${c}</span></b> --- <b><span style="color: #e67e22;">\u5931\u8D25\uFF01</span></b>`),t("Popped CFU failed content")}function j(){document.getElementById("se-ent").status===null||document.getElementById("se-ent").status==="ordinary"?(document.getElementById("se-ent").innerHTML=M,document.getElementById("se-ent").status="update-icon"):(document.getElementById("se-ent").innerHTML=m,document.getElementById("se-ent").status="ordinary"),setTimeout(j,1e3)}function J(e){!e.error&&e.status===200?(t("Get update log success"),$("#se-cgl").append(marked.parse(e.content))):t("Get update log failed")}function C(e){!e.error&&e.status===200&&v.test(e.content)?(t(`Get version success: CV ${c} | LV ${e.content}`),e.content>c&&(R(e.content),j()),e.content<c&&B(e.content),e.content!==c&&(document.getElementById("se-upd").style.display="block",p(O,J))):(t("Get version failed"),T())}var u=["https://cdn.jsdelivr.net/gh/hyc1230/qqemoji/56x56/%EMOJI%.gif","https://ghproxy.com/https://raw.githubusercontent.com/hyc1230/qqemoji/master/56x56/%EMOJI%.gif","https://qqemoji.heyc.eu.org/56x56/%EMOJI%.gif","https://qqemoji.netlify.app/56x56/%EMOJI%.gif"],x={"rep-emj":!0,"srh-emj":!0,"img-src":0,"chk-upd":!0},h=["rep-emj","srh-emj","img-src","chk-upd"],n;function G(){try{let e=GM_getValue("settings","{}");t(`Settings: ${e}`),n=JSON.parse(e)}catch(e){t(`ERROR ${e}`),t("Using default settings"),n=x}for(let e=0;e<h.length;e++)n[h[e]]==null&&(n[h[e]]=x[h[e]])}function L(){t("Loading settings for Luogu"),g=g.replace(/%SOURCE%/g,u[n["img-src"]]),a=a.replace(/%SOURCE%/g,u[n["img-src"]]).replace(/%SOURCE_CY%/g,u[n["img-src"]].replace(/%EMOJI%/g,"cy")),m=m.replace(/%SOURCE_CY%/g,u[n["img-src"]].replace(/%EMOJI%/g,"cy")),n["rep-emj"]&&q()&&(t("Started replacing"),b()),n["srh-emj"]?a=a.replace(/%SRH%/g,"true"):a=a.replace(/%SRH%/g,"false"),I(),n["chk-upd"]&&!0&&p(S,C)}function H(){t("Loading settings for Settings page"),document.getElementById("rep-emj").checked=n["rep-emj"],document.getElementById("srh-emj").checked=n["srh-emj"],document.getElementById("img-src").selectedIndex=n["img-src"],document.getElementById("chk-upd").checked=n["chk-upd"],document.getElementById("status").style.color="#52c41a",document.getElementById("status").innerText="\u52A0\u8F7D\u5B8C\u6210",document.getElementById("info").innerText=JSON.stringify(n)}function k(){let e=document.getElementById("info").innerText;e!==""&&e!==JSON.stringify(n)&&(n=JSON.parse(e),GM_setValue("settings",e),document.getElementById("status").style.color="#52c41a",document.getElementById("status").innerText="\u5DF2\u4FDD\u5B58",t("Saved")),setInterval(k,1e3)}try{t("Started"),G(),document.location.hostname==="www.luogu.com.cn"?L():(H(),k())}catch(e){t(`ERROR ${e}`),t("Crash")}})();
